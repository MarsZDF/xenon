# Xenon

[![CI](https://github.com/MarsZDF/xenon/actions/workflows/ci.yml/badge.svg)](https://github.com/MarsZDF/xenon/actions/workflows/ci.yml)

**Xenon** is a robust, zero-dependency Python library designed to clean up, repair, and secure malformed XML generated by Large Language Models (LLMs).

In the era of RAG and AI agents, applications increasingly rely on structured data outputs. However, LLMs often generate messy XML‚Äîmissing closing tags, conversational fluff, hallucinations, or XSS vulnerabilities. **Xenon** bridges the gap between raw LLM output and reliable application code.

## üöÄ Key Features

- **LLM-Focused Repair**: specifically handles truncation, hallucinations, and conversational text ("Here is your XML: ...").
- **Secure by Default**: Explicit `TrustLevel` system to prevent XSS and injection attacks from untrusted sources.
- **Real-Time Streaming**: Repair XML token-by-token as it arrives from the LLM (compatible with OpenAI/Anthropic streams).
- **Zero Dependencies**: Lightweight and fast; uses only the Python Standard Library.
- **Smart Matching**: Uses Levenshtein distance to fix typoed tags (e.g., `</usre>` ‚Üí `</user>`).
- **Formatting & Diffs**: Built-in pretty-printing and diff generation to visualize repairs.

## Installation

```bash
# Install directly from GitHub
pip install git+https://github.com/MarsZDF/xenon.git

# Or clone and install locally
git clone https://github.com/MarsZDF/xenon.git
cd xenon
pip install -e .
```

## ‚ö° Quick Start

Xenon requires you to specify a **Trust Level** for your input. This ensures you don't accidentally expose your application to security threats from untrusted LLM outputs.

```python
from xenon import repair_xml_safe, parse_xml_safe, TrustLevel

# 1. Repair malformed LLM output
llm_output = 'Sure! <root><user name=john>Hello'
repaired = repair_xml_safe(llm_output, trust=TrustLevel.UNTRUSTED)
print(repaired)
# Output: <root><user name="john">Hello</user></root>

# 2. Parse directly to a dictionary
data = parse_xml_safe(llm_output, trust=TrustLevel.UNTRUSTED)
print(data)
# Output: {'root': {'user': {'@attributes': {'name': 'john'}, '#text': 'Hello'}}}
```

### Trust Levels

| Level | Use Case | Security Features |
|-------|----------|-------------------|
| `UNTRUSTED` | LLM output, user uploads | üîí Strict escaping, strips dangerous tags (script/iframe), prevents XXE & DoS. |
| `INTERNAL` | Internal microservices | üîê Balanced protection, higher depth limits. |
| `TRUSTED` | Hardcoded strings, tests | ‚ö° No overhead, fastest performance. |

## üåä Real-Time Streaming

For RAG pipelines and chat interfaces, you can repair XML **as it is being generated**, reducing latency to near zero. Xenon handles the chunking logic for you.

```python
from xenon.streaming import StreamingXMLRepair
from xenon import TrustLevel

# Works with any iterator (sync or async)
def llm_stream():
    yield "Here is the data:\n<use"
    yield "r id=1>Al"
    yield "ice</user>"

with StreamingXMLRepair(trust=TrustLevel.UNTRUSTED) as repairer:
    for chunk in llm_stream():
        # Yields safe, valid XML fragments immediately
        for safe_fragment in repairer.feed(chunk):
            print(safe_fragment, end="")

# Output: <user id="1">Alice</user>
```

## üõ†Ô∏è Common Repair Scenarios

Xenon automatically handles the most common LLM failure modes:

**1. Truncation / Cut-off**
```python
# Input:  <root><list><item>Item 1
# Output: <root><list><item>Item 1</item></list></root>
```

**2. Conversational Fluff**
```python
# Input:  Here is the XML: <data>value</data> Hope that helps!
# Output: <data>value</data>
```

**3. Malformed Attributes**
```python
# Input:  <user name=john age=25>
# Output: <user name="john" age="25"></user>
```

**4. Unescaped Entities**
```python
# Input:  <text>Barnes & Noble</text>
# Output: <text>Barnes &amp; Noble</text>
```

**5. Hallucinated/Invalid Tags**
```python
# Input:  <123tag>data</123tag>
# Config: sanitize_invalid_tags=True
# Output: <tag_123tag>data</tag_123tag>
```

## üìä Analysis & Formatting

### Diff Reporting
See exactly what the repair engine changed.

```python
from xenon import repair_xml_with_report, TrustLevel

xml = "<root><item>test"
repaired, report = repair_xml_with_report(xml, trust=TrustLevel.UNTRUSTED)

print(report.summary())
# Performed 1 repair(s):
#   - [truncation] Added closing tags for: item, root
```

### Formatting
Pretty-print or minify your XML.

```python
from xenon import format_xml

xml = "<root><item>val</item></root>"
print(format_xml(xml, style="pretty"))
# <root>
#   <item>val</item>
# </root>
```

## Advanced Configuration

For specific needs, you can override security or repair settings individually:

```python
from xenon import repair_xml_safe, TrustLevel

repaired = repair_xml_safe(
    "<root><script>alert(1)</script></root>",
    trust=TrustLevel.UNTRUSTED,
    # Overrides:
    strip_dangerous_tags=False,  # Keep <script> tags (Use with caution!)
    format_output="pretty",      # Auto-format result
    schema_content=my_xsd_schema # Validate against XSD schema
)
```

## Interactive Demo

Try Xenon in your browser with our Google Colab notebook:

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/MarsZDF/xenon/blob/main/xenon_demo.ipynb)

## License

MIT License. See [LICENSE](LICENSE) for details.